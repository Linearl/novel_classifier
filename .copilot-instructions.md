# 小说分类系统 - Copilot 指令文档

## 系统概述

本系统是一个功能强大的小说文件智能分类和管理系统，通过图形界面提供完整的小说库管理解决方案。主程序`novel_gui.py`集成了目录初始化、文件导入、编码修复、智能分类、统计分析等核心功能，提供一站式的图形化管理体验。

## 🖥️ 主程序架构

### novel_gui.py - 核心图形界面

- **集成化设计**：将原本分散的工作流整合到统一的图形界面中
- **实时反馈**：所有操作都提供实时进度显示和状态更新
- **一站式管理**：从初始化到分类完成的完整流程管理
- **配置化支持**：支持通过配置文件自定义分类规则和系统参数
- **错误处理**：完善的异常处理和用户友好的错误提示

### 主要功能模块

1. **小说库管理**：创建和初始化标准目录结构
2. **文件导入**：批量导入txt文件到待分类目录
3. **编码修复**：检测和修复文件编码问题
4. **智能分类**：基于关键词的自动分类处理
5. **统计分析**：实时查看分类统计和分析报告

## 📋 开发和测试指导原则

### GUI 测试策略

- **GUI功能测试**: 所有图形界面相关的测试应该交由用户手动完成
- **自动化测试限制**: 不应尝试自动化GUI应用启动、界面交互或用户界面验证
- **代码验证范围**: 仅对模块导入、方法存在性、配置加载等后端逻辑进行自动验证
- **用户反馈优先**: GUI功能是否正常工作以用户的手动测试结果为准

### Git 提交规范

- **强制性流程**: 执行任何git提交操作时，必须严格遵循 `docs\workflows\git-commit-workflow.md` 中的流程
- **变更审查要求**:
  - 必须获取差异文件列表 (`git status`, `git diff --name-only`)
  - 必须逐个对比并记录每个文件的变更 (`git diff <filename>`)
  - 必须将差异详情、修改原因、影响分析记录到 `commit.md`
- **提交消息规范**: 提交消息应清晰描述变更内容、目的和影响范围
- **禁止行为**: 禁止在没有详细审查每个文件变更的情况下进行提交

## 🎯 功能模块指南

### 终端环境说明

- **PowerShell**: 当前使用的是 PowerShell 终端
- **命令连接**: PowerShell 不支持 `&&` 命令连接符，应使用分号 `;`
- **正确示例**: `cd "d:\path"; python script.py`
- **错误示例**: `cd "d:\path" && python script.py` (会报错)

### AI手动分类工作流

- **文档**: `docs/workflows/4.小说文件AI手动分类工作流.md`
- **触发条件**: 精确分类、人工确认、复杂判断、二次确认文件处理
- **关键词**: 手动分类、精确、人工确认、AI辅助、二次确认
- **主要功能**:
  - AI辅助的人工分类
  - 精确内容分析
  - 复杂情况处理
  - 分类质量保证

## 🚀 智能功能选择策略

### 场景1: 图形界面操作

```
用户提及: "启动程序"、"GUI"、"图形界面"、"novel_gui.py"
→ 指导: 运行 python novel_gui.py 启动主程序
→ 说明: 通过图形界面完成所有操作
```

### 场景2: 二次确认文件处理

```
用户提及: "二次确认"、"精确分类"、"人工确认"、"复杂文件"
→ 推荐: AI手动分类工作流
→ 文档: docs/workflows/4.小说文件AI手动分类工作流.md
```

### 场景3: 独立工具使用

```
用户提及: "命令行"、"独立工具"、"批量处理"、"统计报告"
→ 推荐: 使用tools目录下的独立工具
→ 工具: txt_preview.py, novel_statistics.py, batch_processor.py等
```

## 🔧 工具调用指南

### 主程序启动

```bash
# 启动图形界面主程序
python novel_gui.py
```

### 独立工具使用

```bash
# 文本预览工具
python tools/txt_preview.py --begin "文件路径"

# 统计工具
python tools/novel_statistics.py "小说库路径"

# 批量处理器
python tools/batch_processor.py "小说库路径"

# 快速日志工具
python tools/quick_log.py "小说库路径" classification "文件名" "标题" "分类" "理由"
```

### 快速状态查看

```bash
# 统计各分类文件数量
Get-ChildItem "小说库\" -Filter "*.txt" -Recurse | Measure-Object

# 检查待分类文件
Get-ChildItem "小说库\00-待分类\" | Measure-Object

# 检查二次确认文件
Get-ChildItem "小说库\00-二次确认\" | Measure-Object
```

## 📋 使用指导

### 基本操作流程

```
用户请求
│
├─ 需要图形界面操作？
│  └─ YES → 启动 novel_gui.py，通过界面完成操作
│
├─ 需要处理二次确认文件？
│  └─ YES → 参考 AI手动分类工作流文档
│
└─ 需要独立工具？
   └─ YES → 使用 tools/ 目录下的相应工具
```

## 🎨 最佳实践建议

### 新用户引导流程

1. **启动主程序**: 运行 `python novel_gui.py`
2. **图形界面操作**: 通过GUI完成初始化、导入、修复、分类等操作
3. **二次确认处理**: 对于复杂文件使用AI手动分类工作流
4. **工具辅助**: 必要时使用独立工具进行特定操作

### 日常维护流程

1. **GUI主导**: 日常操作优先使用图形界面
2. **工具补充**: 特殊需求时使用命令行工具
3. **质量保证**: 定期处理二次确认文件
4. **配置优化**: 根据使用情况调整配置文件

##  使用说明

当用户请求与小说文件整理相关的任务时：

1. **分析用户意图**: 判断是否需要图形界面操作、独立工具使用或AI手动分类
2. **推荐方案**: 优先推荐使用novel_gui.py图形界面完成大部分操作
3. **工具补充**: 对于特殊需求推荐相应的独立工具
4. **状态反馈**: 实时反馈处理进度和结果
5. **后续建议**: 根据处理结果提供下一步建议

**注意**: 
- 优先使用图形界面novel_gui.py进行操作
- 复杂分类问题参考AI手动分类工作流文档
- 独立工具用于特定功能和高级用户需求
